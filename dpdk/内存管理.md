---
title: dpdk 内存管理
date: 2023-12-21 14:53:25
categories:
- [dpdk]
tags:
- dpdk
- 内存管理
- mbuf
---

# 参考材料
https://github.com/fly-zero/learning-dpdk/blob/2428702e834ccd241539ddfbc16bc54e94dc2cbf/README.md

# 数据结构图
```graphviz
digraph {
	rte_mem_config[
		label = "{
		<f0>rte_mem_config|
        <f1>malloc_heaps[]|
		<f2>memzones|
		<f3>memsegs[]|
		<f4>...
		}",
		shape = "record"
	];
	rte_fbarray[
		label = "{
		rte_fbarray|
        name|
		count|
		len|
		elt_sz|
		data
		}",
		shape = "record"
	];
	rte_memseg_list[
		label = "{
		<f0>rte_memseg_list|
		<f1>addr_64|
		<f2>page_sz|
		<f3>len|
		<f4>external|
		<f5>heap |
		<f6>memseg_arr
		}",
		shape = "record"
	];
	malloc_heap[
		label = "{
			free_head|
		first|
        last|
		alloc_count|
		total_size|
		name|
		...
		}",
		shape = "record"
	];
	rte_mem_config:f1 -> malloc_heap
	rte_mem_config:f2 -> rte_fbarray
	rte_mem_config:f3 -> rte_memseg_list
}
```
# start
struct malloc_heap {
	rte_spinlock_t lock;
	LIST_HEAD(, malloc_elem) free_head[RTE_HEAP_NUM_FREELISTS];
	struct malloc_elem *volatile first;
	struct malloc_elem *volatile last;

	unsigned int alloc_count;
	unsigned int socket_id;
	size_t total_size;
	char name[RTE_HEAP_NAME_MAX_LEN];
} __rte_cache_aligned;


