---
title: 热迁移代码逻辑
date: 2024-03-20 10:04:03
index_img: https://img-en.fs.com/community/upload/wangEditor/202003/24/_1585046553_TZOmBePO8Z.jpg
categories:
  - [linux,网络开发,虚拟化开发]
tags:
 - kernel_network
 - vdpa
---
# 系统迁移
系统迁移分类:
1. 冷迁移(offline migration)
2. 热迁移(live Migration) 也叫online migration

# 热迁移(Live Migration)，又叫动态迁移、实时迁移
在线迁移有下面几种类型：
 1. 基于共享存储的在线迁移（Live migration）: 需要实例保存在NFS共享存储中，所有的Hypervisor都可以访问共享存储，主要是实例的内存状态的迁移，速度会很快。
 1. 块在线迁移（Block migration）：不要求实例存储在共享文件系统中，即无须共享存储。当各主机上vm使用的是本地存储， 而不是共享存储时， 要实现迁移， 需要实现镜像文件和内存状态同时迁移，还得迁移磁盘文件，速度会慢些。
 1. 基于卷的在线迁移：实例都是基于卷的而不是临时的磁盘，无须共享存储，也支持迁移(目前仅支持基于libvirt的hypervisor)。

 ## 热迁移场景
```
场景 1：
物理机器硬件系统的维护，故障修复和升级(upgrade)，但运行在这台物理机器上的虚拟机不能关机，因为用户重要的服务跑在上面。

场景 2：
物理机器软件系统升级，打补丁(patch)，为了不影响上面跑的虚拟机，在升级和打补丁之前，需要把虚拟机迁移到别的物理机器上。

场景 3：
解除硬件依赖：当系统管理员需要在宿主机上升级、添加、移除某些硬件设备的时候，可以将该宿主机上运行的客户机非常安全、高效地动态迁移到其他宿主机上。在系统管理员升级硬件系统之时，使用动态迁移，可以让终端用户完全感知不到服务有任何暂停时间。

场景 3：
一个物理机器上的负载太重，需要减少一些虚拟机来释放资源。

场景 4：
跨域环境下，有的域里有的物理机上的虚拟机太多，有的域里物理机上虚拟机太少，做一下资源平衡。
```


