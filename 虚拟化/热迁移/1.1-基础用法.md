---
title: 内存热迁移-基础用法
date: 2024-04-20 10:04:03
index_img: https://img-en.fs.com/community/upload/wangEditor/202003/24/_1585046553_TZOmBePO8Z.jpg
categories:
  - [linux,网络开发,虚拟化开发]
tags:
 - kernel_network
 - vdpa
---

# tcp传输
**源端**
```sh
sudo qemu-system-x86_64 -m 4G,slots=4,maxmem=128G -smp 4,maxcpus=16 --enable-kvm \
    -drive file=fedora29.img,format=raw -nographic
```

**目的端**
```sh
sudo qemu-system-x86_64 -m 4G,slots=4,maxmem=128G -smp 4,maxcpus=16 --enable-kvm \
    -drive file=fedora29.img,format=raw -nographic
```

**开始迁移**
此时可以在源端的monitor中执行下面的命令开始迁移
```sh
migrate -d tcp:0:4444
```

# exec传输
这种严格来说不能叫热迁移，因为虚拟机有停顿。不过因为从命令行的形式上看类似，就放在这里。

**源端**
```
sudo qemu-system-x86_64 -m 4G,slots=4,maxmem=128G -smp 4,maxcpus=16 --enable-kvm \
    -drive file=fedora29.img,format=raw -nographic
```
虚拟机的启动是一样的，但是源端启动后就需要在monitor中执行

**stop**
migrate "exec cat > /backup_file"
quit
可以看到，源端的虚拟机不仅停止了，还退出了。

**目的端**
sudo qemu-system-x86_64 -m 4G,slots=4,maxmem=128G -smp 4,maxcpus=16 --enable-kvm \
    -drive file=fedora29.img,format=raw -nographic \
  -incoming "exec:cat < /backup_file"
运行之后在monitor中执行

cont
